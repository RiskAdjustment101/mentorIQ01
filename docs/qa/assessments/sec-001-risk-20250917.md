# QA Risk Analysis — SEC-001 Phase 1 IAM Hardening

**Date:** 2025-09-17
**Owner:** QA Agent (Quinn)
**Story:** docs/stories/story-sec-001-phase1-iam-hardening.md

---

## Threats & Functional Risks
- [ ] **RLS Misconfiguration** — Cross-org reads/writes possible via missing policy or missing `SET app.org_id`.
- [ ] **RBAC Bypass** — Role checks not enforced on API routes; default allow instead of deny.
- [ ] **Consent Leakage** — Child-linked reads not gated by consent view/function; stale cache after revocation.
- [ ] **Audit Tampering** — UPDATE/DELETE allowed; hash chain missing or incorrect.
- [ ] **Webhook/JWT Forgery** — Signatures not verified; iss/aud/exp/nonce not validated; clock skew not handled.
- [ ] **Migration Drift** — Policies present in dev but missing in prod or preview branches.

## Non-Functional & Compliance Risks
- [ ] **Performance Regressions** — RLS/policy functions cause slow queries; missing indexes.
- [ ] **Observability Gaps** — No alerting on policy errors; failed webhooks/JWT validation not surfaced.
- [ ] **Data Retention Misapplied** — Audit retention conflated with PII retention; no rotation jobs.
- [ ] **Backups/Restore** — Audit/consent tables not verified in restore tests.

---

## Mitigations (to verify)
- [ ] CI RLS tests (positive/negative) per org.
- [ ] Unit tests for JWT parse/validate (iss/aud/exp/nonce).
- [ ] Webhook signature verification tests.
- [ ] Append-only trigger & hash chain continuity check in CI.
- [ ] Consent-aware read paths covered by tests; cache bust on revocation.
- [ ] Indexes on `org_id`, `occurred_at`, join keys; query plans captured.

---

## Status
PASS / CONCERNS / FAIL
